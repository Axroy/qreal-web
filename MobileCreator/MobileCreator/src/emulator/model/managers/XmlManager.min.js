define(["require","exports","utils/log/Log","emulator/model/logic/Logic","emulator/model/logic/Trigger","emulator/model/Page","emulator/model/ui/TextView","emulator/model/ui/Button","emulator/model/ui/Input","emulator/model/ui/ImageView","emulator/model/ui/WebView","emulator/model/ui/LinearLayout","emulator/model/attributes/LinearLayoutTag","emulator/model/attributes/ControlTag","emulator/model/attributes/TextViewTag","emulator/model/attributes/ButtonTag","emulator/model/attributes/InputTag","emulator/model/attributes/ImageViewTag","emulator/model/attributes/WebViewTag"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){var nt=i,tt=r,it=u,rt=f,ut=e,ft=o,et=s,ot=h,st=c,ht=l,g=a,d=v,ct=y,lt=p,at=w,vt=b,yt=k,pt=function(){function n(){this.logger=new nt.Logger("XmlManager"),this.logicFunctionFactory=new tt.FunctionFactory,this.logger.log("in constructor")}return n.App="application",n.Forms="forms",n.Form="form",n.FormName="form_name",n.LinearLayout="LinearLayout",n.TextView="TextView",n.EditText="EditText",n.Button="Button",n.ImageView="ImageView",n.WebView="WebView",n.Logic="logic",n.Trigger="trigger",n.FormId="form-id",n.Event="event",n.Seq="seq",n.SeqFirst="first-operator",n.SeqSecond="second-operator",n.If="if",n.Then="then",n.Else="else",n.Transition="transition",n.LoginRequest="login-request",n.SaveSession="save-session",n.PatientsRequest="patients-request",n.ShowMap="showmap",n.prototype.parsePage=function(n){this.logger.log("parse page: "+n);var t=new XMLHttpRequest,i;try{t.open("GET",n,!1),t.send(null),i=t.responseXML}catch(r){return window.alert("Unable to load the requested file."),undefined}return this.parseNode(i.firstChild)},n.prototype.parseXmlString=function(n){this.logger.log("parseXmlString");var t=new DOMParser,i=t.parseFromString(n,"text/xml");return this.parseApplication(i.firstChild)},n.prototype.parseApplication=function(t){var i,r,u;for(this.logger.log("parseApplication: "+t.nodeName),i=0;i<t.childNodes.length;i++){r=t.childNodes.item(i);switch(r.nodeName){case n.Forms:u=this.parseForms(r);break;case n.Logic:this.parseLogic(r)}}return u},n.prototype.parseLogic=function(t){var r,i,u;for(this.logger.log("parseLogic: "+t.nodeName),r=t.childNodes.length,i=0;i<r;i++){u=t.childNodes.item(i);switch(t.nodeName){case n.Trigger:this.parseTrigger(u)}}},n.prototype.parseTrigger=function(n){var t,e,i;this.logger.log("parseTrigger: "+n.nodeName);var o=n.attributes["form-id"].value,u=n.attributes.event.value,r,f=n.childNodes.length;for(t=0;t<f;t++)e=n.childNodes.item(t),i=this.parseLogicNode(n),i&&(r=i);return new it.Trigger(u,r)},n.prototype.parseLogicNode=function(t){this.logger.log("parse logic node: "+t.nodeName);switch(t.nodeName){case n.Seq:return this.parseSeq(t);case n.Transition:return this.parseTransition(t);case n.LoginRequest:return this.parseLoginRequest(t);default:return undefined}},n.prototype.parseSeq=function(t){var u,f,e,i,r;for(this.logger.log("parseSeq"),e=t.childNodes.length,i=0;i<e;i++){r=t.childNodes.item(i);switch(r.nodeName){case n.SeqFirst:u=this.parseLogicNode(r);break;case n.SeqSecond:f=this.parseLogicNode(r)}}return this.logicFunctionFactory.seqFunc(u,f)},n.prototype.parseTransition=function(n){this.logger.log("parseTransition");var t=n.attributes["form-id"].value;return this.logicFunctionFactory.transitionFunc(t)},n.prototype.parseLoginRequest=function(n){this.logger.log("parseLoginRequest");var t=n.attributes.url.value,i=n.attributes["login-id"].value,r=n.attributes["password-id"].value;return this.logicFunctionFactory.loginRequestFunc(t,i,r)},n.prototype.parseForms=function(t){for(var r=[],i=0;i<t.childNodes.length;i++)t.childNodes.item(i).nodeName==n.Form&&r.push(this.parseForm(t.childNodes.item(i)));return r},n.prototype.parseForm=function(n){this.logger.log("parseForm: "+n.nodeName);var t=n.attributes.form_name.value,i=this.parseNode(n.childNodes.item(1));return new rt.Page(t,i)},n.prototype.parseNode=function(t){this.logger.log("parse node: "+t.nodeName);var i;switch(t.nodeName){case n.LinearLayout:i=this.parseLinearLayout(t);break;case n.TextView:i=this.parseTextView(t);break;case n.EditText:i=this.parseInput(t);break;case n.Button:i=this.parseButton(t);break;case n.ImageView:i=this.parseImageView(t);break;case n.WebView:i=this.parseWebView(t)}return i},n.prototype.parseLinearLayout=function(n){var i,r,u,t,f;for(this.logger.log("parseLinearLayout"),i=new g.LinearLayoutTag,this.fillLinearLayoutData(n,i),r=new ht.LinearLayout(i),u=n.childNodes.length,this.logger.log("parseLinearLayout length: "+u),t=0;t<u;t++)f=this.parseNode(n.childNodes.item(t)),f&&r.addChild(f);return r},n.prototype.parseTextView=function(n){var t;return this.logger.log("parseTextView"),t=new ct.TextViewTag,this.fillTextViewData(n,t),new ut.TextView(t)},n.prototype.parseInput=function(n){var t;return this.logger.log("parseInput"),t=new at.InputTag,this.fillInputData(n,t),new et.Input(t)},n.prototype.parseButton=function(n){var t;return this.logger.log("parseButton"),t=new lt.ButtonTag,this.fillButtonData(n,t),new ft.Button(t)},n.prototype.parseImageView=function(n){var t;return this.logger.log("parseImageView"),t=new vt.ImageViewTag,this.fillImageViewData(n,t),new ot.ImageView(t)},n.prototype.parseWebView=function(n){var t;return this.logger.log("parseWebView"),t=new yt.WebViewTag,this.fillWebViewData(n,t),new st.WebView(t)},n.prototype.fillLinearLayoutData=function(n,t){this.fillControlPanelData(n,t);var i=n.attributes.orientation;i&&(this.logger.log("orientation: "+i.value),t.Orientation=i.value=="vertical"?g.LinearLayoutTag.Vertical:g.LinearLayoutTag.Horizontal)},n.prototype.fillTextViewData=function(n,t){var i,r;this.fillControlTagData(n,t),i=n.attributes.text,i&&(this.logger.log("text: "+i.value),t.Text=i.value),r=n.attributes.textSize,r&&(this.logger.log("textSize: "+r.value),t.TextSize=parseInt(r.value))},n.prototype.fillInputData=function(n,t){this.fillTextViewData(n,t)},n.prototype.fillButtonData=function(n,t){this.fillTextViewData(n,t);var i=n.attributes.onClick;i&&(this.logger.log("onClick: "+i.value),t.OnClick=i.value)},n.prototype.fillImageViewData=function(n,t){this.fillControlTagData(n,t);var i=n.attributes.src;i&&(this.logger.log("src: "+i.value),t.ImageUrl=i.value)},n.prototype.fillWebViewData=function(n,t){this.fillControlTagData(n,t);var i=n.attributes.url;i&&(this.logger.log("url: "+i.value),t.Url=i.value)},n.prototype.fillControlPanelData=function(n,t){this.fillControlTagData(n,t)},n.prototype.fillControlTagData=function(n,t){var c=n.attributes.id,i,r,u,f,e,o,s,h;if(c&&(this.logger.log("id: "+c.value),t.Id=c.value),i=n.attributes.layout_width,i){this.logger.log("layout_width: "+i.value);switch(i.value){case"wrap_content":t.Width=d.ControlTag.WrapContent;break;case"fill_parent":t.Width=d.ControlTag.MatchParrent;break;default:t.Width=parseInt(i.value)}}if(r=n.attributes.layout_height,r){this.logger.log("layout_height: "+r.value);switch(r.value){case"wrap_content":t.Height=d.ControlTag.WrapContent;break;case"fill_parent":t.Height=d.ControlTag.MatchParrent;break;default:t.Height=parseInt(r.value)}}u=n.attributes.background,u&&(this.logger.log("background: "+u.value),t.Background=u.value),f=n.attributes.gravity,f&&(this.logger.log("gravity: "+f.value),t.Gravity=f.value),e=n.attributes.layout_marginTop,e&&(this.logger.log("layout_marginTop: "+e.value),t.MarginTop=parseInt(e.value)),o=n.attributes.layout_marginBottom,o&&(this.logger.log("layout_marginBottom: "+o.value),t.MarginBottom=parseInt(o.value)),s=n.attributes.layout_marginLeft,s&&(this.logger.log("layout_marginLeft: "+s.value),t.MarginLeft=parseInt(s.value)),h=n.attributes.layout_marginRight,h&&(this.logger.log("layout_marginRight: "+h.value),t.MarginRight=parseInt(h.value))},n}();t.XmlManager=pt})